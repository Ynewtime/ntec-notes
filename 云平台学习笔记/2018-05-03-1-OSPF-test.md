---
layout: post
share: true
title: enspä½¿ç”¨æŒ‡å¯¼
description: ospf_test.topo / å†…å®¹æ¶‰åŠOSPFåŸºæœ¬ç»„ç½‘æ–¹æ³•åŠOSPFç®€å•ç½‘ç»œæ‹“æ‰‘
author: Stephen Tseng
date: May 02, 2018
---

### è®¾å¤‡æ‹“æ‰‘

```
                                GE0/0/1(IP:12.1.1.2)-GE0/0/2(IP:23.1.1.1)
                                |
                                |
    Ethernet0/0/0(IP:10.1.1.2)  |           GE0/0/2(IP:23.1.1.2)-GE0/0/24(IP:20.1.1.1)
    |                           |           |
    |                           |           |
client1<-->sw1(s5700)<-->R1(router)<-->sw2(s5700)<-->server1
                |                                       |
                |                                       Ethernet0/0/0(IP:20.1.1.2)
                GE0/0/24(IP:10.1.1.1)-GE0/0/1(IP:12.1.1.1)
```

```
                       ---->ç½‘æ®µä¸º23.1.1.0/30; vlan10
                       |
                       |
å®¢æˆ·ç«¯--äº¤æ¢æœº1--è·¯ç”±å™¨1--äº¤æ¢æœº2--æœåŠ¡å™¨  //ä½¿ç”¨OSPF100è¿›ç¨‹ï¼Œareaä¸º0
              |
              |
              ---->ç½‘æ®µä¸º12.1.1.0/30; vlan10
```

ğŸ‘‰ ä½¿ç”¨è°ƒè‰²æ¿åŒºåˆ†ä¸åŒarea

### åŸºæœ¬é…ç½®è¦æ±‚

client1:  
 - IP:10.1.1.2/24  
 - GW:10.1.1.1  
 - vlan100  

Server1:
 - IP:20.1.1.2/24
 - GW:20.1.1.1
 - vlan200

### é…ç½®è¿‡ç¨‹

ğŸ“Œ å‘½ä»¤ä¸åŒºåˆ†å¤§å°å†™ï¼›æ´»ç”¨tabé”®å’Œ ? æŸ¥è¯¢å‘½ä»¤  
ğŸ“Œ ç»™æ¯å°è®¾å¤‡é…ç½®ä¸€ä¸ªloopbackå£ï¼Œä½œä¸ºè¯¥è®¾å¤‡çš„router-id

#### äº¤æ¢æœº1é…ç½®

```bash
//äº¤æ¢æœº1å’Œclientçš„äº’è”ä¿¡æ¯
<Huawei>sys  //ä»ç”¨æˆ·è§†å›¾è¿›å…¥ç³»ç»Ÿè§†å›¾
[Huawei]sys SW1  //å°†äº¤æ¢æœº1å‘½åä¸ºSW1
[SW1]vlan 100  //åˆ›å»ºvlan 100
[SW1-vlan100]q  //é€€å‡ºvlan 100ç•Œé¢
[SW1]int g 0/0/24  //è¿›å…¥0/0/24ç«¯å£é…ç½®vlanä¸ºvlan100
[SW1-GigabitEthernet0/0/24]port link-type access  //ä¿®æ”¹ç«¯å£ç±»å‹ä¸ºaccess
[SW1-GigabitEthernet0/0/24]port default vlan 100  //ä¿®æ”¹pvidä¸º100
[SW1-GigabitEthernet0/0/24]q  //é€€å‡º0/0/24é…ç½®ç•Œé¢
[SW1]int vlan 100  //è¿›å…¥vlan100é…ç½®ç•Œé¢ç»™vlan100é…ç½®IPåœ°å€
[SW1-Vlanif100]ip address 10.1.1.1 24  //vlan100çš„IPåœ°å€ä¸ºclientç½‘å…³ï¼Œâ— åˆ«å¿˜äº†æ©ç ä¸º24ä½

//äº¤æ¢æœº1å’Œè·¯ç”±å™¨1çš„äº’è”ä¿¡æ¯
[SW1]vlan 10  //åˆ›å»ºvlan 10
[SW1-vlan10]int vlan 10  //è¿›å…¥vlan10é…ç½®ç•Œé¢ç»™vlan10é…ç½®IPåœ°å€
[SW1-Vlanif10]ip address 12.1.1.1 30  //â— åˆ«å¿˜äº†æ©ç ä¸º30ä½
[SW1]int g 0/0/1  //è¿›å…¥0/0/1ç«¯å£é…ç½®vlanä¸ºvlan10
[SW1-GigabitEthernet0/0/1]port link-type access  //ä¿®æ”¹ç«¯å£ç±»å‹ä¸ºaccess
[SW1-GigabitEthernet0/0/1]port default vlan 10  //æ¥å£0/0/1ä¸ºvlan10

//äº¤æ¢æœº1çš„loopbacké…ç½®
[SW1]int loop 0  //ç»™äº¤æ¢æœº1æ–°å»ºä¸€ä¸ªloopbackå£0
[SW1-LoopBack0]ip address 1.1.1.1 32  //é…ç½®è¯¥loopbackå£çš„IPåœ°å€ä¸º1.1.1.1ï¼Œæ©ç ä¸º32ä½

//äº¤æ¢æœº1çš„OSPFé…ç½®
[SW1]ospf 100 router-id 1.1.1.1  //åˆ†é…äº¤æ¢æœº1ä¸ºospfè¿›ç¨‹å·100ï¼ŒåŒæ—¶router-idä¸º1.1.1.1
[SW1-ospf-100]area 0  //æ–°å»ºä¸€ä¸ªarea 0
[SW1-ospf-100-area-0.0.0.0]network 10.1.1.0 0.0.0.255  //å°†æ¥å£0/0/24ä½¿èƒ½ospf
[SW1-ospf-100-area-0.0.0.0]network 12.1.1.0 0.0.0.3  //å°†æ¥å£0/0/1ä½¿èƒ½ospf
```

#### äº¤æ¢æœº2é…ç½®

```bash
//äº¤æ¢æœº2å’Œserverçš„äº’è”ä¿¡æ¯
<Huawei>sys  //ä»ç”¨æˆ·è§†å›¾è¿›å…¥ç³»ç»Ÿè§†å›¾
[Huawei]sys SW2  //å°†äº¤æ¢æœº2å‘½åä¸ºSW2
[SW2]vlan 200  //åˆ›å»ºvlan 200
[SW2]int vlan 200  //è¿›å…¥vlan200 é…ç½®ç•Œé¢ç»™vlan200é…ç½®IPåœ°å€
[SW2-Vlanif200]ip address 20.1.1.1 24  //vlan100çš„IPåœ°å€ä¸ºserverç½‘å…³ï¼Œâ— åˆ«å¿˜äº†æ©ç ä¸º24ä½
[SW2-Vlanif200]int g 0/0/24  //è¿›å…¥0/0/24ç«¯å£é…ç½®vlanä¸ºvlan200
[SW2-GigabitEthernet0/0/24]port link-type access  //ä¿®æ”¹ç«¯å£ç±»å‹ä¸ºaccess
[SW2-GigabitEthernet0/0/24]port default vlan 200  //ä¿®æ”¹pvidä¸º200


//äº¤æ¢æœº2å’Œè·¯ç”±å™¨1çš„äº’è”ä¿¡æ¯
[SW2]vlan 10  //åˆ›å»ºvlan 10
[SW2-vlan10]int vlan 10  //è¿›å…¥vlan10é…ç½®ç•Œé¢ç»™vlan10é…ç½®IPåœ°å€
[SW2-Vlanif10]ip address 23.1.1.2 30  //â— åˆ«å¿˜äº†æ©ç ä¸º30ä½
[SW2]int g 0/0/2  //è¿›å…¥0/0/2ç«¯å£é…ç½®vlanä¸ºvlan10
[SW2-GigabitEthernet0/0/2]port link-type access  //ä¿®æ”¹ç«¯å£ç±»å‹ä¸ºaccess
[SW2-GigabitEthernet0/0/2]port default vlan 10  //æ¥å£0/0/2ä¸ºvlan10

//äº¤æ¢æœº2çš„loopbacké…ç½®
[SW2]int loop 0  //ç»™äº¤æ¢æœº2æ–°å»ºä¸€ä¸ªloopbackå£0
[SW2-LoopBack0]ip address 3.3.3.3 32  //é…ç½®è¯¥loopbackå£çš„IPåœ°å€ä¸º3.3.3.3ï¼Œæ©ç ä¸º32ä½

//äº¤æ¢æœº2çš„OSPFé…ç½®
[SW2]ospf 100 router-id 3.3.3.3  //åˆ†é…äº¤æ¢æœº2ä¸ºospfè¿›ç¨‹å·100ï¼ŒåŒæ—¶router-idä¸º3.3.3.3
[SW2-ospf-100]area 0  //æ–°å»ºä¸€ä¸ªarea 0
[SW2-ospf-100-area-0.0.0.0]network 23.1.1.0 0.0.0.3  //å°†æ¥å£0/0/2ä½¿èƒ½ospf
[SW2-ospf-100-area-0.0.0.0]network 20.1.1.0 0.0.0.255  //å°†æ¥å£0/0/24ä½¿èƒ½ospf
```

#### è·¯ç”±å™¨1é…ç½®

```bash
//è·¯ç”±å™¨1ä¸äº¤æ¢æœº1ã€2çš„äº’è”ä¿¡æ¯
<Huawei>sys  //ä»ç”¨æˆ·è§†å›¾è¿›å…¥ç³»ç»Ÿè§†å›¾
[Huawei]sys R1  //å°†è·¯ç”±å™¨1å‘½åä¸ºR1
[R1]int g 0/0/1  //è¿›å…¥0/0/1æ¥å£è§†å›¾ä¸‹é…ç½®IPåœ°å€
[R1-GigabitEthernet0/0/1]ip address 12.1.1.2 30  //ä¸SW1äº’è”çš„0/0/1ç«¯å£çš„IPåœ°å€ä¸º12.1.1.2
[R1-GigabitEthernet0/0/1]int g 0/0/2  //è¿›å…¥åˆ°0/0/2æ¥å£è§†å›¾ä¸‹é…ç½®IPåœ°å€
[R1-GigabitEthernet0/0/2]ip address 23.1.1.2 30  //ä¸SW2äº’è”çš„0/0/2ç«¯å£çš„IPåœ°å€ä¸º23.1.1.1
[R1]q  //é€€å‡º0/0/2ç«¯å£é…ç½®ç•Œé¢
[R1]ping 23.1.1.2  //æµ‹è¯•è·¯ç”±å™¨1ä¸äº¤æ¢æœº2çš„äº’é€šæ€§

//è·¯ç”±å™¨1çš„loopbacké…ç½®
[R1]int loop 0  //ç»™è·¯ç”±å™¨1æ–°å»ºä¸€ä¸ªloopbackå£0
[R1-LoopBack0]ip address 2.2.2.2 32  //é…ç½®è¯¥loopbackå£çš„IPåœ°å€ä¸º2.2.2.2ï¼Œæ©ç ä¸º32ä½

//è·¯ç”±å™¨1çš„OSPFé…ç½®
[R1]ospf 100 router-id 2.2.2.2  //åˆ†é…è·¯ç”±å™¨1ä¸ºospfè¿›ç¨‹å·100ï¼ŒåŒæ—¶router-idä¸º2.2.2.2
[R1-ospf-100]area 0  //æ–°å»ºä¸€ä¸ªarea 0
[R1-ospf-100-area-0.0.0.0]network 12.1.1.0 0.0.0.3  //å°†æ¥å£0/0/1ä½¿èƒ½ospf
[R1-ospf-100-area-0.0.0.0]network 23.1.1.0 0.0.0.3  //å°†æ¥å£0/0/2ä½¿èƒ½ospf
```

### çŠ¶æ€æŸ¥çœ‹

```bash
[R1]dis ospf peer b  //æŸ¥çœ‹è·¯ç”±å™¨1çš„é‚»å±…çŠ¶æ€
[R1]dis ip routing-table  //æŸ¥çœ‹è·¯ç”±å™¨1çš„è·¯ç”±è¡¨
```

ğŸ”¨ pingæµ‹è¯•ï¼š
 - ping:20.1.1.2  //è¿›å…¥client1çª—å£ç•Œé¢ï¼ŒpingæœåŠ¡å™¨IPæµ‹è¯•è¿é€šæ€§

ğŸ”¨ ftpæµ‹è¯•ï¼š
  1. å…ˆé…ç½®serverçš„ftpä¿¡æ¯ï¼›â— æ³¨æ„ftpçš„ä½ç½®è·¯å¾„åº”ä¸ºå…¨è‹±æ–‡ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ä¼šå‡ºé”™ï¼›  
  2. é…ç½®client1çš„ftpä¿¡æ¯ï¼ˆæœåŠ¡å™¨IPå³å¯ï¼Œå…¶ä»–ä¸ºé»˜è®¤ï¼‰è¿›è¡Œç™»é™†ã€‚

ğŸ”¨ æ•°æ®æŠ“åŒ…æµ‹è¯•ï¼š
  ç›´æ¥å³é”®ç‚¹å‡»ç«¯å£å³å¯

### ä¿å­˜æ‹“æ‰‘

1. é¦–å…ˆä¿å­˜é…ç½®ä¿¡æ¯ï¼›
 - é€€å‡ºåˆ°ç”¨æˆ·è§†å›¾ä¸‹<Huawei>ï¼Œé”®å…¥å‘½ä»¤saveï¼ŒYç¡®è®¤ï¼Œè¾“å…¥ä¿å­˜çš„é…ç½®æ–‡ä»¶åç§°å³å¯
2. é€šè¿‡å·¥å…·æ çš„ä¿å­˜æŒ‰é’®æˆ–è€… ctrl+S ä¿å­˜æ‹“æ‰‘ã€‚